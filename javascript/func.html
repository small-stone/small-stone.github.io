<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>函数 | 小石头的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="兰生幽谷，不以无人而不芳">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.530d3c12.js" as="script"><link rel="preload" href="/assets/js/2.4b40b10b.js" as="script"><link rel="preload" href="/assets/js/16.cb43e51d.js" as="script"><link rel="prefetch" href="/assets/js/10.f9aa1217.js"><link rel="prefetch" href="/assets/js/11.c3f7e2c6.js"><link rel="prefetch" href="/assets/js/12.43bff649.js"><link rel="prefetch" href="/assets/js/13.b1eff259.js"><link rel="prefetch" href="/assets/js/14.746a98fb.js"><link rel="prefetch" href="/assets/js/15.bb3d0104.js"><link rel="prefetch" href="/assets/js/17.50ad3a18.js"><link rel="prefetch" href="/assets/js/18.fe50ec38.js"><link rel="prefetch" href="/assets/js/19.5b85ddae.js"><link rel="prefetch" href="/assets/js/3.bbe5046a.js"><link rel="prefetch" href="/assets/js/4.b7d0708f.js"><link rel="prefetch" href="/assets/js/5.9e2f4ca7.js"><link rel="prefetch" href="/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/assets/js/7.469ef684.js"><link rel="prefetch" href="/assets/js/8.ca1c59ae.js"><link rel="prefetch" href="/assets/js/9.e9b25eaf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小石头的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/computerbase/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/javascript/" class="nav-link router-link-active">
  javaScript
</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">
  TypeScript
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/computerbase/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/javascript/" class="nav-link router-link-active">
  javaScript
</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">
  TypeScript
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/javascript/" aria-current="page" class="sidebar-link">js 代码是怎么执行的？</a></li><li><a href="/javascript/func.html" aria-current="page" class="active sidebar-link">函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/func.html#函数的本质" class="sidebar-link">函数的本质</a></li><li class="sidebar-sub-header"><a href="/javascript/func.html#函数是一等公民" class="sidebar-link">函数是一等公民</a></li></ul></li><li><a href="/javascript/toPrimitive.html" class="sidebar-link">类型转换</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h1> <p>我们都听过这样一句话：</p> <blockquote><p>js 中函数是一等公民</p></blockquote> <p>为什么函数被称为一等公民？难道还有二等公民吗？其实原因在于 JavaScript 中的函数就是一种特殊的对象，在 JavaScript 中，你可以将一个函数赋值给一个变量，还可以将函数作为一个参数传递给另外一个函数，甚至可以使得一个函数返回另外一个函数，这在一些主流语言中都很难实现。</p> <p>基于函数是一等公民的设计，使得 JavaScript 非常容易实现一些特性，比如闭包，还有函数式编程等，而其他语言要实现这些特性就显得比较困难，比如要在 C++ 中实现闭包需要实现大量复杂的代码，而且使用起来也异常复杂。</p> <p>函数式编程和闭包在实际的项目中会经常遇到，如果不了解这些特性，那么在你使用第三方代码时就会非常吃力，同时自己也很难使用这些特性写出优雅的代码，因此我们很有必要了解这些特性的底层机制。</p> <h2 id="函数的本质"><a href="#函数的本质" class="header-anchor">#</a> 函数的本质</h2> <p>函数是一种特殊的对象，它和对象一样可以拥有属性和值，但是函数和普通对象不同的是，函数可以被调用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
foo<span class="token punctuation">.</span>myName <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span>uName <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>myName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在 V8 内部，会为函数对象添加了两个隐藏属性，具体属性如下图所示： <img src="https://static001.geekbang.org/resource/image/9e/e2/9e274227d637ce8abc4a098587613de2.jpg" alt=""></p> <p>函数除了可以拥有常用类型的属性值之外，还拥有两个隐藏属性，分别是 name 属性和 code 属性。</p> <h2 id="函数是一等公民"><a href="#函数是一等公民" class="header-anchor">#</a> 函数是一等公民</h2> <p>在执行 JavaScript 函数的过程中，为了实现变量的查找，V8 会为其维护一个作用域链，如果函数中使用了某个变量，但是在函数内部又没有定义该变量，那么函数就会沿着作用域链去外部的作用域中查找该变量 <img src="https://static001.geekbang.org/resource/image/8b/fd/8bb90b190362e3a00e5a260bad6829fd.jpg" alt=""> 函数内部引用了外部的变量时，使用这个函数进行赋值、传参或作为返回值，你还需要保证这些被引用的外部变量是确定存在的，这就是让函数作为一等公民麻烦的地方，因为虚拟机还需要处理函数引用的外部变量。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    number<span class="token operator">++</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> bar<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> mybar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mybar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>那么所谓的“函数是一等公民”就体现在，如果要返回函数 bar 给外部，那么即便 foo 函数执行结束了，其内部定义的 number 变量也不能被销毁，因为 bar 函数依然引用了该变量。</p> <p><strong>我们也把这种将外部变量和和函数绑定起来的技术称为闭包。</strong></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javascript/" class="prev router-link-active">
        js 代码是怎么执行的？
      </a></span> <span class="next"><a href="/javascript/toPrimitive.html">
        类型转换
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.530d3c12.js" defer></script><script src="/assets/js/2.4b40b10b.js" defer></script><script src="/assets/js/16.cb43e51d.js" defer></script>
  </body>
</html>
